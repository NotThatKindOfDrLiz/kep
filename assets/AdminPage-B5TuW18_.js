import{r as l,j as e,R as O}from"./index-BEffNcEt.js";import{T as U,U as V,V as N,W as v,r as Y,H as K,B as c,t as w,L as x,S as C,o as S,p as k,K as I,q as R,X as $,Y as q,Z as L,I as b,_ as G,s as J,Q as A}from"./Header-xmHO3h7T.js";const Q=()=>{const[s,r]=l.useState("items");return e.jsxs("div",{className:"container max-w-5xl mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Admin Dashboard"}),e.jsxs(U,{defaultValue:"items",value:s,onValueChange:r,children:[e.jsxs(V,{className:"grid grid-cols-3 mb-8",children:[e.jsx(N,{value:"items",children:"Agenda Items"}),e.jsx(N,{value:"threads",children:"Threads"}),e.jsx(N,{value:"settings",children:"Settings"})]}),e.jsx(v,{value:"items",className:"space-y-6",children:e.jsx(W,{})}),e.jsx(v,{value:"threads",className:"space-y-6",children:e.jsx(Z,{})}),e.jsx(v,{value:"settings",className:"space-y-6",children:e.jsx(_,{})})]})]})},W=()=>{const{data:s,isLoading:r}=Y(),{data:m=[],isLoading:u}=K((s==null?void 0:s.id)||""),[i,o]=l.useState("priority"),[n,p]=l.useState(!1),j=[...m].sort((a,d)=>i==="newest"?d.createdAt-a.createdAt:i==="oldest"?a.createdAt-d.createdAt:a.priority!==void 0&&d.priority!==void 0?a.priority-d.priority:a.priority!==void 0?-1:d.priority!==void 0?1:d.createdAt-a.createdAt),f=n?j.filter(a=>a.starred):j;return r||u?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800 rounded-md",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:[w(s.startDate,"MMMM d")," - ",w(s.endDate,"MMMM d")]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{htmlFor:"sort-order",className:"text-sm whitespace-nowrap",children:"Sort by:"}),e.jsxs("select",{id:"sort-order",value:i,onChange:a=>o(a.target.value),className:"text-sm rounded-md border border-input bg-background px-3 py-1",children:[e.jsx("option",{value:"priority",children:"Priority"}),e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{id:"filter-starred",checked:n,onCheckedChange:p}),e.jsx(x,{htmlFor:"filter-starred",className:"text-sm",children:"Show starred only"})]})]})]}),e.jsx("div",{className:"space-y-4 mt-6",children:f.length>0?f.map(a=>e.jsx(X,{item:a,threadId:s.id},a.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No",n?" starred":""," agenda items found."]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-lg mb-4",children:"No active agenda thread found"}),e.jsx(c,{asChild:!0,children:e.jsx("a",{href:"/",children:"Create a new agenda thread"})})]})},X=({item:s,threadId:r})=>{var o;const{mutate:m}=L(),u=()=>{var n;m({kind:1,content:s.content,tags:[["thread",r],["t","kep-agenda-item"],["anonymous",s.isAnonymous?"true":"false"],["priority",((n=s.priority)==null?void 0:n.toString())||"999"],["starred",s.starred?"false":"true"]]})},i=n=>{m({kind:1,content:s.content,tags:[["thread",r],["t","kep-agenda-item"],["anonymous",s.isAnonymous?"true":"false"],["priority",n.toString()],["starred",s.starred?"true":"false"]]})};return e.jsxs(S,{className:`w-full ${s.starred?"border-yellow-400":""}`,children:[e.jsxs(k,{className:"flex flex-row items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:u,className:`mr-2 ${s.starred?"text-yellow-500":"text-gray-400"}`,"aria-label":s.starred?"Unstar item":"Star item",children:s.starred?"★":"☆"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:s.isAnonymous?"Anonymous":((o=s.submittedBy)==null?void 0:o.name)||"Unknown user"}),e.jsx("div",{className:"text-xs text-gray-400",children:w(s.createdAt*1e3,"MMM d, h:mm a")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-sm mr-2",children:["Priority: ",s.priority||"None"]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>i(s.priority?s.priority-1:1),"aria-label":"Increase priority",children:"↑"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>i(s.priority?s.priority+1:999),"aria-label":"Decrease priority",children:"↓"})]})]}),e.jsx(R,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.content})})]})},Z=()=>e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(I,{children:"Thread Management"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsx("p",{children:"Thread management functionality will be expanded in future versions."}),e.jsx("p",{children:"For now, threads are automatically created weekly."}),e.jsx("div",{className:"mt-4",children:e.jsx(c,{asChild:!0,children:e.jsx("a",{href:"/",children:"Return to Current Thread"})})})]})]}),_=()=>{const{nostr:s}=$(),{data:r,isLoading:m}=q(),{mutate:u}=L(),[i,o]=l.useState([]),[n,p]=l.useState(""),[j,f]=l.useState(""),[a,d]=l.useState(""),[h,y]=l.useState([]),[T,M]=l.useState(!0),[D,F]=l.useState(!0);O.useEffect(()=>{r&&(o(r.admins),f(r.defaultRelay),y(r.additionalRelays),M(r.threadAutoCreation),F(r.showSubmissionsByDefault))},[r]);const B=()=>{n.trim()&&!i.includes(n.trim())&&(o([...i,n.trim()]),p(""))},P=t=>{o(i.filter(g=>g!==t))},z=()=>{a.trim()&&!h.includes(a.trim())&&(y([...h,a.trim()]),d(""))},E=t=>{y(h.filter(g=>g!==t))},H=()=>{const t=G(i,j,h),g=JSON.stringify({threadAutoCreation:T,showSubmissionsByDefault:D});u({kind:t.kind,content:g,tags:t.tags})};return m?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-lg",children:"Loading settings..."})}):e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(I,{children:"Admin Settings"})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Admin Access"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(x,{htmlFor:"new-admin",children:"Add Administrator (by public key)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{id:"new-admin",placeholder:"npub...",value:n,onChange:t=>p(t.target.value)}),e.jsx(c,{onClick:B,children:"Add"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Current Administrators:"}),i.length>0?e.jsx("ul",{className:"space-y-2",children:i.map(t=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-slate-50 dark:bg-slate-800 rounded",children:[e.jsx("span",{className:"text-sm truncate max-w-[80%]",children:t}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>P(t),"aria-label":"Remove admin",children:"✕"})]},t))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No administrators defined."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Relay Configuration"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(x,{htmlFor:"default-relay",children:"Default Relay"}),e.jsx(b,{id:"default-relay",placeholder:"wss://...",value:j,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(x,{htmlFor:"additional-relay",children:"Additional Relays"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{id:"additional-relay",placeholder:"wss://...",value:a,onChange:t=>d(t.target.value)}),e.jsx(c,{onClick:z,children:"Add"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Current Additional Relays:"}),h.length>0?e.jsx("ul",{className:"space-y-2",children:h.map(t=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-slate-50 dark:bg-slate-800 rounded",children:[e.jsx("span",{className:"text-sm truncate max-w-[80%]",children:t}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>E(t),"aria-label":"Remove relay",children:"✕"})]},t))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No additional relays defined."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"General Settings"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"auto-create",checked:T,onCheckedChange:M}),e.jsx(x,{htmlFor:"auto-create",children:"Automatically create weekly agenda threads"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"show-default",checked:D,onCheckedChange:F}),e.jsx(x,{htmlFor:"show-default",children:"Show submissions to all participants by default"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(c,{onClick:H,children:"Save Settings"})})]})]})};function te(){const{isAdmin:s,isLoading:r}=J();return r?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500",children:"Checking admin permissions"})]})})]}):s?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1",children:e.jsx(Q,{})}),e.jsx("footer",{className:"border-t py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:e.jsx("div",{className:"container",children:e.jsxs("p",{children:["Kep Admin - Built on Nostr - ",new Date().getFullYear()]})})})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"You don't have admin permissions for this application."}),e.jsx("a",{href:"/",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"Return to Home"})]})})]})}export{te as default};
